#  21장 로깅과 사용 추적
거의 모든 서버와 프락시는 처리했던 HTTP 트래잭션을 요약해서 기록해 놓는다.
어떤 HTTP 트랜잭션 정보를 기록하는지, 로그 포맷에는 보통 어떤 것들이 있는지 알아보자

## 21.1 로그란 무엇인가?
로깅을 하는 이유는 대체로 2가지 이다.
서버나 프락시의 문제를 찾거나 웹 사이트 접근 통계를 내기 위해 로깅을 한다.
HTTP 트랜잭션의 모든 헤더를 로깅할 수는 있지만 보통은 트랜잭션의 기본적인 항목들만 로깅한다.

## 21.2 로그 포맷
로그 포맷에는 여러 표준이 있다. 이 중 몇가지 일반 포맷을 다룰 것이다.
HTTP 애플리케이션은 대부분 표준 로그 포맷을 한 개 이상 지원하며 그 애플리케이션 대부분은 로그 포맷을 설정하고 자체 맞춤 포맷을 만들 수 있는 설정 기능을 제공한다.

애플리케이션이 더 많은 표준 포맷을 지원하고 관리자가 그것을 사용함으로써 얻는 가장 큰 이득은 관리자가 직접 지정한 필드를 포함한 로그 포맷을 통해 필요한 통계를 추출할 수 있기 때문에 그 도구를 더 잘 활용할 수 있다는 것이다.

### 21.2.1 일반 로그 포맷
가장 일반적은 포맷 중 하나는 **일반 로그 포맷**이다.
많은 서버가 이 로그 포맷을 기본으로 사용한다. 

### 21.2.2 혼합 로그 포맷
많이 사용하는 또 다르 포맷은 혼합 로그 포맷이다.
이 포맷은 아파치 같은 서버들이 지원한다.

### 21.2.3 넷스케이프 확장 로그 포맷
넷스케이프가 상용 HTTP 애플리케이션이 되면서 다른 애플리케이션 개발자들이 사용하는 서버의 여러 로그 포맷을 도입했다.
넷스케이프의 포맷은 NCSA 일반 로그 포맷에서 시작했지만, 프락시나 웹 캐시 같은 HTTP 애플리케이션과 연관이 있는 여러 환경을 지원하려고 포맷을 확장했다.

### 21.2.4 넷스케이프 확장 2 로그 포맷
또 다른 넷스케이프 로그 포맷인 넷스케이프 확장 2 로그 포맷은 확장 로그 포맷에서 HTTP 프락시와 웹 캐시 애플리케이션과 관련한 더 많은 정보를 포함한다.
이렇게 추가된 필드들은 HTTP 클라이언트와 HTTP 프락시 애플리케이션 간의 통신을 설계하는 데 도움이 된다.

### 21.2.5 스퀴드 프락시 로그 포맷
스퀴드 프락시 캐시는 웹 분야에서 권위 있는 프로젝트다.
스퀴드는 수년가 오픈 소스 커뮤니티를 통해 확장 및 개선되어 온 프로젝트이다.

스퀴드 로그 엔트리의 포맷은 꽤 단순하다.

## 21.3 적중 계량하기
원 서버는 결산을 하기 위해 상세 로그를 저장한다.
로깅은 클라이언트가 웹 서버에 직접 방문했을 때 이런 것들을 추적하는데 유용하다,

하지만 클라이언트와 서버 사이에 캐시가 있어 많은 요청이 서버까지 오진 않아 로그 파일에 누락을 발생시킨다.

로그 데이터가 유실되기 때문에 콘텐츠 제공자는 어쩔 수 없이 중요한 페이지의 캐시를 파기한다.
캐시 파기는 콘텐츠 생산자가 의도적으로 특정 콘텐츠가 캐시되지 않게 만드는 것이므로 이 콘텐츠에 대한 모든 요청은 원 서버로 간다. 하지만 요청에 대한 응답 속도는 느려지고 원 서버와 네트워크의 부하가 가중된다.

프락시 캐시들은 자체 로그를 유지하기 때문에, 만약 서버가 그 로그에 접근할 수 있거나, 혹은 얼마나 자주 서버의 콘텐츠가 서버의 콘텐츠가 프락시 캐시에서 제공되는지 알 수 있는 불완전한 방법이라도 있으면 캐시 파기는 피할 수 있을 것이다.

적중 계량 규약은 HTTP의 확장으로 그 문제의 해결책으로 제시되었다.

### 21.3.1 개요
적중 계량 규약은 캐시와 서버가 접근 정보를 공유하고 사용할 수 있는 캐시 리소스의 양을 제어할 수 있는 몇 가지 기초적인 기능에 관한 HTTP 확장을 정의한다.

### 21.3.2 Meter 헤더
적중 계량 확장은 Meter라는 새로운 헤더를 추가했다.
Cache-Control 헤더에 다양한 캐시 지시자를 기술할 수 있듯이, 캐시나 서버는 Meter 헤더에 사용량이나 보고에 관한 지시자가 기술할 수 있다.

### 21.4 개인 정보 보호에 대해
실제 로깅은 서버와 프락시에서 수행하는 관리 기능이므로 모든 것이 사용자의 트랜잭션에 적용된다. 사용자는 자신의 HTTP 트랜잭션이 로깅되고 있다는 것을 모를 수 있다.

로깅은 관리자와 개발자에게 매우 유용한 도구지만 로깅을 당하는 사용자들의 인지나 허가가 없으면 로깅이 사생활 침해가 된다는 것을 유념해야 한다.
