# HTTP 메시지
HTTP가 인터넷의 배달원이라면 HTTP 메시지는 무언가를 담아 보내는 소포와 같다.
이번 장은 HTTP 메시지의 모든 것에 대해 말해준다.

## 3.1 메시지의 흐름
HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이다.
이 데이터 블록들은 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고
그 다음 선택적으로 데이터가 올 수 있다.

해당 메시지가 클라이언트, 서버, 프락시 사이를 흐른다.

### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다.
HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다.
**인바운드**: 메시지가 원 서버로 향하는 것
**아웃 바운드**: 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.

### 3.1.2 다운스트림으로 흐르는 메시지
HTTP 메시지는 강물과 같이 흐른다.
요청 메시지냐 응답 메시지냐에 관계없이 모든 메시지는 다운스트림으로 흐른다.
메시지의 발송자는 수신자의 업스트림이다.

## 3.2 메시지의 각 부분
HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.

각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함한다.
또한 메시지는 시작줄, 헤더블록, 본문 세 부분으로 이루어진다.

시작줄: 이것이 어떤 메시지인지 서술
헤더 블록: 속성
본문: 데이터를 담음(아예 없을 수도 있다)

시작줄과 헤더는 줄 단위로 구분된 아스키 문자열이며 각 줄은 캐리지 리턴(\r)과 개행문자(\n)으로 구성된 두 글자의 줄바꿈 문자열로 끝난다.

### 3.2.1 메시지 문법
모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.
클라이언트가 서버에 어떤 동작을 요청하면 서버가 요청의 결과를 클라이언트에 돌려주는 구조이다.

요청 메시지의 형식은 다음과 같다.
<메서드> <요청 URL> <버전>
<헤더>
<엔티티 본문>

응답 메시지의 형식은 다음과 같다.
<버전><상태 코드><사유구절>
<헤더>
<엔티티 본문>

- 메서드
클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작이다.
'GET','HEAD','POST'와 같이 한 단어로 되어 있다.

- 요청 URL
요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소이다.

- 버전
이 메시지에서 사용 중인 HTTP의 버전이다. 형식은 다음과 같다.
HTTP/<메이저>.<마이너>

- 상태코드
요청 중에 무엇이 일어났는지 설명하는 세자리 숫자이다.
각 코드의 첫 번째 자리수는 상태의 일반적인 분류를 나타낸다.

- 사유구절
숫자로 된 상태코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구로
상태코드 이후부터 줄바꿈 문자열까지가 사유구절이다.

- 헤더들
이름, 콜론, 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들
이 헤더의 목록은 빈 줄로 끝나 헤더 목록의 끝과 엔티티 본문의 시작을 표시한다.

- 엔티티 본문
엔티티 본문은 임의의 데이터 블록을 포함한다.
모든 메시지가 엔티티 본문을 갖는것은 아니므로 때때로 메시지는 그냥 CRLF로 끝나게 된다.
*역사적으로 많은 클라이언트와 서버가 엔티티 본문이 없는 경우 실수로 마지막 CRLF를 빠뜨린다. 이와같이 널리 쓰이지만 규칙을 잘 지키지 않는 구현체와 호환을 위해, 클라이언트와 서버는 마지막 CRLF 없이 끝나는 메시지도 받아들일 수 있어야 한다.* 

### 3.2.2 시작줄
모든 HTTP 메시지는 시작줄로 시작한다.
요청 메시지의 시작줄은 무엇을 해야 하는지 말해주며
응답 메시지의 시작줄은 무슨 일이 일어났는지 말해준다.

**요청줄**
요청 메시지는 서버에게 리소스에 대해 무언가를 해달라고 부탁한다.
요청줄은 
- 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드
- 그 동작에 대한 대상을 지칭하는 요청URL
- 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전
을 포함하며 이 모든 필드는 공백으로 구분된다
 
 **응답줄**
 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려준다.
응답 메시지의 시작 줄 혹은 응답 줄에는 
- 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태코드
- 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절
이 들어있다.
모든 필드는 모두 공백으로 구분된다.

**메서드**
요청의 시작줄은 메서드로 시작하며 서버에게 무엇을 해야 하는지 말해준다.
HTTP 명세는 공통 요청 메서드의 집합을 정의한다.
또한 HTTP는 쉽게 확장할 수 있도록 설계되었기 때문에, 다른 서버는 그들만의 메서드를 추가로 구현했을 수도 있으며 이러한 추가 메서드는 HTTP 명세를 확장하는 것이기 때문에 확장 메서드라고 불린다.

**상태 코드**
메서드가 서버에게 무엇을 해야 하는지 말해주는 것처럼 상태코드는 클라이언트에게 무엇이 일어났는지 말해준다.
상태 코드는 각 응답 메시지의 시작줄에 담겨 반환된다. 숫자로 된 코드와, 문자열로 되어 있어서 사람이 이해하기 쉬운 메시지 두 형태 모두로 반환된다.

**사유 구절**
사유 구절은 응답 시작줄의 마지막 구성요소이다. 이것은 상태 코드에 대한 글로 된 설명을 제공한다.

**버전 번호**
버전 번호는 HTTP/x,y 형식으로 요청과 응답 메시지 양쪽 모두에 기술된다.
이것은 HTTP 애플리케이션들이 자신이 따르는 프로토콜 버전을 상대방에게 말해주기 위한 수단이 된다.
버전 번호는 HTTP로 대화하는 애플리케이션들에게 대화 상대의 능력과 메시지의 형식에 대한 단서를 제공해주기 위한 것이다.

### 3.2.3 헤더
HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다.
그들은 기본적으로 이름/값 쌍의 목록이다.

***헤더 분류***
HTTP 헤더 명세는 여러 헤더 필드를 정의한다. 애플리케이션은 또한 자유롭게 자신만의 헤더를 만들어 낼 수 있다.

**일반 헤더**
요청과 응답 양쪽에 모두 나타날 수 있음

**요청 헤더**
요청에 대한 부가 정보를 제공

**응답 헤더**
응답에 대한 부가 정보를 제공

**Entity 헤더**
본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술

**확장 헤더**
명세에 정의되지 않은 새로운 헤더

***헤더를 여러 줄로 나누기***
긴 헤더 줄은 그들을 여러 줄로 쪼개서 더 읽기 좋게 만들 수 있는데 
추가 줄 앞에는 최소 하나의 스페이스 혹은 탭 문자가 와야 한다.

### 3.2.4 엔티티 본문
HTTP 메시지의 세 번째 부분은 선택적인 엔티티 본문이다.
엔티티 본문은 HTTP 메시지의 화물이라고 할 수 있다.

### 3.2.5 버전 0.9 메시지
HTTP 버전 0.9는 HTTP 프로토콜의 초기 버전이다.
그것은 오늘날 HTTP가 갖고 있는 요청과 응답 메시지의 시초이지만, 훨씬 단순한 프로토콜로 되어있다.
