# 웹 호스팅
리소스를 공용 웹 서버에 올려놓으면 인터넷을 통해 이용할 수 있다.
콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 웹 호스팅이라 한다.

## 18.1 호스팅 서비스
웹이 빠르게 대세가 되며 모든 사람이 웹 사이트를 원했지만 서버를 운영할 기술과 시간을 가진 사람은 드물었다. 그 시간을 절약하기 위해 웹 호스팅 서비스를 제공하는 여러 사업이 만들어졌다.

## 18.2 가상 호스팅
많은 사람들이 웹 사이트를 가지고 싶어 하지만
이러한 공간은 대부분의 시간에는 놀고 있을것이다. 하지만 이러한 사이트에 많은 돈이 드는 전용 웹 서버를 제공하는 것은 낭비이다.

많은 호스팅 업체에서 컴퓨터 한 대를 여러 고객이 공유하게 해 저렴한 웹 호스팅 서비스를 제공한다. 이를 공유 호스팅 혹은 가상 호스팅이라 부른다.

각 웹 사이트는 다른 서버에서 호스팅 하는 것처럼 보이겠지만, 사실은 물리적으로 같은 서버에서 호스팅되는 것이며 사용자는 이를 구분할 수 없다.

### 18.2.1 호스트 정보가 없는 가상 서버 요청
HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을 제공하지 않는다.
웹 서버는 사용자가 어떤 웹 사이트로 접근하려고 하는지 아는데 필요한 정보가 충분하지 않다.
두 요청이 다른 문서를 요청하더라도 요청 자체는 똑같이 생겼다.

### 18.2.2 가상 호스팅 동작하게 하기
초기 명세는 가상 호스팅을 고려하지 않았기 때문에 웹 호스팅 업자는 공용 가상 호스팅을 지원하는데 필요한 차선책과 컨벤션을 개발해야 했다.
그 문제는 모든 요청 메시지에 경로 컴포넌트만 보내는 것이 아니라 완전한 URL도 포함해 보내게 해서 간단히 해결했다.

HTTP/1.1을 지원하는 서버는 HTTP요청 메시지에 있는 전체 URL을 처리할 수 있어야 한다.
하지만 기존의 모든 애플리케이션이 이 명세에 맞추어 업그레이드 하기까지는 오랜 시간이 걸릴것이기 때문에 네가지 기술이 나타났다.

**URL 경로를 통한 가상 호스팅**
공용 서버에 있는 각 가상 사이트에 서로 다른 URL 경로를 할당해서 각각을 강제로 구분할 수 있다.
index.html 파일이라도 a/index.html , b/index.html 처럼 앞에 특정 경로를 붙여 구분할 수 있다.
하지만 이는 좋지 않은 방법이다.

**포트번호를 통한 가상 호스팅**
 경로명을 변경하는 대신 다른 포트번호를 할당할 수 있다.
 하지마 사용자는 URL에 비표준 포트를 쓰지 않고서도 리소스를 찾길 원하기 때문이다.

**IP 주소를 통한 가상 호스팅**
더 좋은 방법은 가상 IP를 할당 하는 것이다.
이 방식은 각 가상 웹 사이트에 유일한 IP 주소를 한 개 이상 부여한다.
서버는 HTTP 커넥션의 목적지 IP 주소를 보고 클라이언트가 어떤 웹 사이트에 연결하려고 하는지 알 수 있다.

가상 호스팅은 잘 동작하지만, 규모가 아주 큰 호스팅 업자에게는 약간 어려운 문제를 안겨준다.
- 일반적으로 컴퓨터 시스템이 연결할 수 있는 장비의 IP의 개수에는 제한이 있다.
- IP 주소는 희소 상품이다.
- IP 주소가 부족한 문제는 호스팅 업자가 용량을 늘리려고 서버를 복제하면서 더 심각해진다.

**Host 헤더를 통한 가상 호스팅**
IP 주소의 낭비와 가상 IP의 제한 문제를 피하려면, 가상 사이트들이 같은 IP를 사용하더라도 각 사이트가 어디에 속해 있는지 알 수 있어야 한다. 
이 문제를 해결하려고 브라우저와 서버 개발자들은 서버가 원 호스트 명을 받아 볼 수 있게 HTTP를 확장했다.

### 18.2.3 HTTP/1.1 Host 헤더
가상 서버는 매우 흔하기 떄문에 대부분의 HTTP 클라이언트가 HTTP/1.1과 호환되지 않더라도
Host 헤더를 구현한다.

**문법과 사용방법**
Host 헤더에는 원본 URL에 있는 요청 리소스에 대한 인터넷 호스트와 포트번호를 기술한다.
Host = "Host" ":" 호스트[":" 포트]

**Host 헤더의 누락**
아직 사용되고 있는 몇몇 낡은 브라우저들은 Host 헤더를 보내지 않는다.
만약 헤더가 존재하지 않는다면, 서버는 사용자를 기본 웹페이지로 보내거나 브라우저를 업그레이드하라고 제안하는 에러 페이지를 반환할 수 있다.

**Host 헤더 해석하기**
호스트를 기준으로 리소스를 구분하는 모든 웹 서버는 HTTP/1.1을 통해 리소스를 결정하려면 다음과 같은 규칙을 사용해야 한다.
1. HTTP 요청 메시지에 전체 URL이 기술되어 있으면 Host 헤더에 있는 값은 무시하고 URL을 사용하다.
2. HTTP 요청 메시지에 있는 URL에 호스트 명이 기술되어 있지 않고 요청에 Host 헤더가 있으면, 호스트 명과 포트를 Host 헤더에서 가져온다.
3. 1단계나 2단계에서 호스트를 결정할 수 없으면 클라이언트에 400 응답을 반환한다.

**Host 헤더와 프락시**
특정 브라우저 버전은 부정확한 Host 헤더를 보내는데, 특히 프락시를 사용하게 설정했을 때 그렇다.

## 18.3 안정적인 웹 사이트 만들기
웹 사이트에 장애가 생기는 몇 가지 상황이 있다.
- 서버 다운
- 트래픽 폭증
- 네트워크 장애나 손실
이러한 문제에 예측하고 대응하는 몇 가지 방법을 살펴보자

### 18.3.1 미러링 된 서버 팜
서버 팜은 서로 대시할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합이다.
서버팜의 서버에 있는 콘텐츠들은 한 곳에 문제가 생기면 다른 한 곳에서 대신 전달할 수 있게 미러링 할 수 있다.

보통 미러링 된 서버는 계층적인 관계에 있다.
한 서버는 '콘텐츠의 원본 제작자' 같이 행동한다.
이 서버를 마스터 원 서버라 부른다.
마스터 원 서버로부터 콘텐츠를 받은 미러링 된 서버는 복제 원 서버라 부른다.
서버 팜에 배포하는 간단한 방법은 네트워크 스위치를 사용해서 서버에 분산 요청을 보내는 것이다.

클라이언트의 요청이 특정 서버로 가는 두 가지 방법이 있다.
- HTTP 리다이렉션: 콘텐츠에 대한 URL은 마스터 서버의 IP를 가리키고, 마스터 서버는 요청을 받는 즉시 복제 서버로 리다이렉트 시킨다.
- DNS 리다이렉션: 콘텐츠의 URL은 네 개의 IP 주소를 가리킬 수 있고, DNS 서버는 클라이언트에게 전송할 IP 주소를 선택할 수 있다.

### 18.3.2 콘텐츠 분산 네트워크
콘텐츠 분산 네트워크는 특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크이다.
네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있다.

### 18.3.3 CDN의 대리 캐시
대리 캐시는 복제 원 서버를 대신해 사용될 수 있다.
리버스 프락시라고도 불리는 대리 서버는 미러링 된 웹 서버처럼 콘텐츠에 대한 요청을 받는다.
그들은 특정 원 서버 집합을 대신해 요청을 받는다.(이는 콘텐츠에 대한 IP 주소가 알려졌기 때문에 가능하다)

대리 서버와 미러링 된 서버의 차이점은, 대리 서버는 보통 수요에 따라서 동작 한다는 것이다.
대리 서버는 원 서버의 전체 콘텐츠를 복사하지는 않는다. 클라이언트가 요청하는 콘텐츠만 저장할 뿐이다.
대리 서버의 캐시에 콘텐츠가 분산되는 방식은 그들이 받는 요청에 따라 달라진다.

### 18.3.4 CDN의 프락시 캐시
대리 서버와는 다르게, 전통적인 프락시 캐시는 어떤 웹 서버 요청이든지 다 받을 수 있다.
하지만 대리 서버를 사용하면, 프락시 캐시의 콘텐츠는 요청이 있을 때만 저장될 것이고 원본 서버 콘텐츠를 정확히 복제한다는 보장이 없다.

요청이 있을 때만 저장하는 프락시 캐시는 조금 다른 방식으로 동작하는데, 레이어2 혹은 레이어3 장비가 중간에서 웹 트래픽을 가로채 처리하기도 한다.
